<!doctype html><html lang="en"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><title>Cart - G Mart</title><link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"></head><body class="bg-gray-50 text-gray-800"><header class="bg-green-700 text-white p-4"><div class="container mx-auto"><a href="/products.html">Products</a></div></header><main class="container mx-auto py-8"><h2 class="text-2xl font-bold mb-4">Your Cart</h2><div id="items"></div><div id="summary" class="mt-6"></div><div id="paypal-button-container" class="mt-6"></div></main><script>async function render(){const cart=JSON.parse(localStorage.getItem('gcart')||'[]');if(cart.length===0){document.getElementById('items').innerText='Cart is empty';return;}const products=await Promise.all(cart.map(c=>fetch('/api/products/'+c.id).then(r=>r.json())));let total=0;const itemsEl=document.getElementById('items');itemsEl.innerHTML='';cart.forEach((c,i)=>{const p=products[i];total+=p.price*c.qty;const div=document.createElement('div');div.className='bg-white p-3 rounded shadow mb-2 flex justify-between items-center';div.innerHTML=`<div><b>${p.name}</b><div class='text-sm'>$${(p.price/100).toFixed(2)} x ${c.qty}</div></div><div><button onclick='remove("${p._id}")' class='text-red-600'>Remove</button></div>`;itemsEl.appendChild(div);});document.getElementById('summary').innerHTML=`<div class='bg-white p-4 rounded shadow'><div class='font-bold'>Total: $${(total/100).toFixed(2)}</div></div>`; // create order and render PayPal buttons
const createRes=await fetch('/api/create-paypal-order',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({items:cart, customer:{email:prompt('Enter email for receipt')}})});const data=await createRes.json();const script=document.createElement('script');script.src='https://www.paypal.com/sdk/js?client-id=REPLACE_WITH_YOUR_PAYPAL_CLIENT_ID&currency=USD';document.body.appendChild(script);script.onload=()=>{paypal.Buttons({createOrder:()=>data.id,onApprove: async (dataApp)=>{await fetch('/api/capture-paypal-order',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({orderID:dataApp.orderID})});alert('Payment successful');localStorage.removeItem('gcart');location.href='/';}}).render('#paypal-button-container');};}window.remove=function(id){const cart=JSON.parse(localStorage.getItem('gcart')||'[]').filter(i=>i.id!==id);localStorage.setItem('gcart',JSON.stringify(cart));render();};render();</script></body></html>