<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gmart â€” Cart</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Header -->
  <header class="site-header small">
    <div class="brand"><h1>G<span>Mart</span></h1></div>
    <div class="header-actions">
      <button id="themeToggle" class="ghost-btn">ðŸŒ™</button>
      <a href="index.html" class="link-btn">Home</a>
      <a id="authLink" href="auth.html" class="link-btn">Login</a>
      <button id="logoutBtn" class="ghost-btn" style="display:none">Logout</button>
    </div>
  </header>

  <!-- Main Cart -->
  <main class="container">
    <h2>Your Cart</h2>
    <div id="cartList" class="cart-list"></div>

    <div class="cart-summary" id="cartSummary">
      <div>Total items: <span id="totalQty">0</span></div>
      <div>Total price: <strong id="totalPrice">â‚¬0.00</strong></div>
      <div class="cart-actions">
        <button id="clearCart" class="secondary">Clear Cart</button>
        <button id="checkoutBtn" class="primary">Proceed to Checkout</button>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <small>Â© Gmart</small>
  </footer>

  <script type="module">
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    // Theme toggle
    let darkMode = localStorage.getItem('darkMode') === 'true';
    if (darkMode) body.classList.add('dark');
    themeToggle.textContent = darkMode ? 'â˜€ï¸' : 'ðŸŒ™';
    themeToggle.addEventListener('click', () => {
      body.classList.toggle('dark');
      darkMode = body.classList.contains('dark');
      themeToggle.textContent = darkMode ? 'â˜€ï¸' : 'ðŸŒ™';
      localStorage.setItem('darkMode', darkMode);
    });

    // Auth toggle
    const authLink = document.getElementById('authLink');
    const logoutBtn = document.getElementById('logoutBtn');
    let userToken = localStorage.getItem('userToken') || null;
    function updateAuthUI() {
      if (userToken) {
        authLink.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
      } else {
        authLink.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
      }
    }
    updateAuthUI();
    logoutBtn.addEventListener('click', () => {
      userToken = null;
      localStorage.removeItem('userToken');
      updateAuthUI();
    });

    // Cart functions
    function getCart() {
      return JSON.parse(localStorage.getItem('cart') || '[]');
    }

    function saveCart(cart) {
      localStorage.setItem('cart', JSON.stringify(cart));
      displayCart();
    }

    function clearCart() {
      localStorage.removeItem('cart');
      displayCart();
    }

    function updateQty(productId, delta) {
      const cart = getCart();
      const item = cart.find(i => i._id === productId);
      if (!item) return;
      item.qty += delta;
      if (item.qty <= 0) {
        const index = cart.indexOf(item);
        cart.splice(index, 1);
      }
      saveCart(cart);
    }

    function displayCart() {
      const cart = getCart();
      const container = document.getElementById('cartList');
      const totalQtyEl = document.getElementById('totalQty');
      const totalPriceEl = document.getElementById('totalPrice');
      const cartSummary = document.getElementById('cartSummary');

      container.innerHTML = '';
      if (!cart || cart.length === 0) {
        container.innerHTML = `<p>Your cart is empty. <a href="index.html" class="link-btn">Shop Now</a></p>`;
        cartSummary.style.display = 'none';
        return;
      }
      cartSummary.style.display = 'block';

      let totalQty = 0, totalPrice = 0;
      cart.forEach(item => {
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <h3>${item.name}</h3>
          <p>Price: â‚¬${(item.price / 100).toFixed(2)}</p>
          <p>Quantity: ${item.qty}</p>
          <button class="qty-btn">+</button>
          <button class="qty-btn">-</button>
        `;
        div.querySelectorAll('.qty-btn')[0].addEventListener('click', () => updateQty(item._id, 1));
        div.querySelectorAll('.qty-btn')[1].addEventListener('click', () => updateQty(item._id, -1));

        container.appendChild(div);

        totalQty += item.qty;
        totalPrice += item.price * item.qty;
      });

      totalQtyEl.textContent = totalQty;
      totalPriceEl.textContent = `â‚¬${(totalPrice / 100).toFixed(2)}`;
    }

    document.getElementById('clearCart').addEventListener('click', clearCart);

    displayCart();
  </script>
</body>
</html>
